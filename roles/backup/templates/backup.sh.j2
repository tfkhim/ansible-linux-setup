#!/bin/sh

# Private Ansible playbook
#
# Copyright (C) 2019 T. Himmelstoss
#
# This software may be freely distributed under the MIT license. You should
# have received a copy of the MIT License along with this program.

RCLONE_CONFIG={{rclone_conf}}

{% for task in rclone_sync_tasks %}
rclone --verbose --config=${RCLONE_CONFIG} sync {{task.source}} {{task.target}}
{% endfor %}

export BORG_RSH='ssh -i {{ssh_key}}'

{% for task in borgbackup_tasks %}
export BORG_PASSPHRASE='{{task.password}}'
cd '{{task.path}}'
borgbackup --verbose create --exclude '.stfolder' {{task.repo}}::'{hostname}-{now}' .

{% endfor %}
